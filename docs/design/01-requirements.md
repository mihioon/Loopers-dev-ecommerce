# 1. 상품 목록 / 상품 상세 / 브랜드 조회

## 1-1. 상품 목록 조회

> 사용자는 상품 리스트를 정렬과 필터를 통해 페이지단위로 조회한다.
>

### ✅  기능적 요구사항

- **공통
  -** 전체 상품 목록을 페이지 단위로 조회.
- 각 상품별로 **상품명, 가격, 대표 이미지, 브랜드명, 총 좋아요 수**를 포함
- **정렬 및 필터**
- `sort` 기본값 : `latest`
- **사용자 (비로그인/로그인)**:
    - **비로그인/로그인 사용자**: `전시중`이 아닌 상품은 목록에서 제외
    - **로그인 사용자**: `X-USER-ID`를 기반으로 현재 사용자의 '좋아요' 여부 포함

---

**⚠️ 제약 조건**

- `size` 파라미터는 최대 `100`으로 제한 (`limit > 100` 초과시 → 100으로 자동 조정되어 처리)

---

**❌ 실패 케이스**

| **케이스** | **HTTP 상태코드** | **비고**                                                             |
| --- | --- |--------------------------------------------------------------------|
| 유효하지 않은 필터 파라미터 | `400 Bad Request` | 필터 값 형식이 잘못된 경우(예: 문자열에 숫자)                                        |
| 로그인 사용자 `X-USER-ID` 누락 | `200 OK`(예외적 정상 처리) | 좋아요 제외한 정상 응답                                                      |
| `size > 100` | `200 OK`(예외적 정상 처리) | `size=100`으로 강제 고정 후 응답                                            |
| 페이지 번호 초과 | `200 OK`(예외적 정상 처리) | 빈 배열 반환                                                            |
| `ProductService` 조회 실패 | `200 OK`(예외적 정상 처리) | `상품 목록 = []`로 응답, 프론트 재조회 유도                                       |
| 일부 서비스 데이터 조회 실패 | `200 OK`(예외적 정상 처리) | `BrandService`, `ImageService`, `LikeService` <br> 부분적 정보 생략 또는 대체 후 응답 |

### ⚙️ 비기능적 요구사항

- 성능: **500ms** 이내 응답
- 캐싱: 특정 정렬 기준 1페이지 응답은 **Redis 또는 CDN 캐싱** 고려(Top-N + 주기적 배치 갱신)
    - 최신순, 좋아요 순 우선 고려
- 페이지네이션 **Offset-based** 기반 통일

## 1-2. 상품 상세 조회

> 사용자는 `productId` 에 해당하는 상품의 상세정보를 조회한다.
>

### ✅ 기능적 요구사항

- **공통**
- 각 상품별로 **상품명, 가격, 대표 이미지, 브랜드명, 상세 이미지 목록, 재고 수량, 총 좋아요 수**를 포함
- `판매중지` 상품의 상세 조회 가능(구매 불가 상태 표기)
- **로그인 사용자**: `X-USER-ID`를 기반으로 현재 사용자의 '좋아요' 여부 포함

---

**⚠️ 제약 조건**

- `productId`는 유효한 숫자 형식이어야 함

---

**❌ 실패 케이스**

| **케이스** | **HTTP 상태코드** | **비고**                                                             |
| --- | --- |--------------------------------------------------------------------|
| `productId` 형식 오류 | `400 Bad Request` |                                                                    |
| 존재하지 않거나 접근 불가능한 상품 ID | `404 NOT FOUND` | 1)상품이 존재하지 않거나 삭제된 경우 <br> 2)전시중이 아닌 경우 |
| `판매중지` 상품 조회 | `200 OK`(예외적 정상 처리) | 상세 정보는 보여주되, 상태 표기 필요                                              |
| `X-USER-ID` 누락 | `200 OK`(예외적 정상 처리) | 좋아요 여부 제외하고 응답 (옵셔널)                                               |
| `ProductService` 조회 실패 | `500 INTERNAL SERVER ERROR` | DB 장애, 서비스 오류 등 근본적인 실패                                            |
| 일부 서비스 데이터 조회 실패 | `200 OK`(예외적 정상 처리) | `BrandService`, `ImageService`, `LikeService` <br> 부분적 정보 생략 또는 대체 후 응답 |

### ⚙️비기능적 요구사항

- 성능: **500ms** 이내 응답

## 1-3. 브랜드 정보 조회

> 사용자는 해당하는 브랜드의 정보를 조회한다.
>

### ✅  기능적 요구사항

- **공통**
- 개별 브랜드의 브랜드명, 설명, 대표 이미지를 조회한다.
    - 브랜드에 속한 상품 리스트는 별도 API(상품 목록조회 > 브랜드명 필터링을 통해 조회)

---

**⚠️ 제약 조건**

- `brandId`는 유효한 숫자 형식이어야 함

---

**❌ 실패 케이스**

| **케이스** | **HTTP 상태코드** | **비고**                                  |
| --- | --- |-----------------------------------------|
| `brandId` 형식 오류 | `400 Bad Request` |                                         |
| 존재하지 않거나 접근 불가능한 브랜드 ID | `404 NOT FOUND` | 1)상품이 존재하지 않거나 삭제된 경우 <br> 2)전시중이 아닌 경우 |
| 브랜드 상태값 누락 등 비정상 데이터 | `500 INTERNAL SERVER ERROR` | DB 장애, 서비스 오류 등 근본적인 실패                 |
| 일부 서비스 데이터 조회 실패 | `200 OK (예외적 정상 처리)` | `ImageService` <br> 대표 이미지 생략 또는 기본값으로 대체    |

### ⚙️ 비기능적 요구사항

- 성능: **500ms** 이내 응답

# 2. 상품 좋아요 등록/취소 (멱등 동작)

> 로그인한 사용자는 상품에 좋아요를 등록하고 취소한다.
>

### ✅  기능적 요구사항

- **공통**
- 특정 상품에 대해 좋아요를 등록하거나 취소
- 좋아요 한 상품 리스트는 별도 API(상품 목록조회 > 좋아요 필터링을 통해 조회)
    - 멱등성 보장: 요청 상태와 현재 상태가 같더라도 정상 처리
        - `post` → 좋아요 요청
        - `delete` → 좋아요 취소 요청

---

**⚠️ 제약 조건**

- `X-USER-ID` 필수(로그인 사용자만 요청 가능)
- 동일 요청 중복시 서버는 최종 상태만 반영
- 좋아요 상태 중복 등록 불가능

---

**❌ 실패 케이스**

| 케이스 | 응답 코드 | 비고 |
| --- | --- | --- |
| 인증 불가 | `401 UNAUTHORIZED` | 1)`X-USER-ID` 헤더 없음
2)`X-USER-ID`는 있으나 유효한 사용자가 아님 |
| 불가능한 상품 | `404 NOT FOUND` | 1)상품이 존재하지 않거나 삭제된 경우
2)전시중이 아닌 경우 |
| 등록 실패 | `500 INTERNAL SERVER ERROR` | DB 장애, 서비스 오류 등 근본적인 실패 |

### ⚙️ 비기능적 요구사항

- 성능: **300ms** 이내 응답
- 멱등 동작 보장
- 동시성 상황
    - 좋아요 상태 및 수가 정확해야 함
    - 최종 요청 상태만 반영

# 3. 주문 생성 및 결제 흐름 (재고 차감, 포인트 차감, 외부 시스템 연동)

> 사용자는 상품을 주문하고 결제할 수 있으며, 주문 상태를 추적할 수 있다.
>

### ✅  기능적 요구사항

- **공통**
- 상품을 주문 요청시 주문 생성, 결제가 완료되면 주문 확정 됨
    - 주문 요청시 순차적 진행
        1. 주문 생성
        2. 포인트 차감
        3. 외부 PG 결제 요청
        4. 재고 차감
    - 중간 단계에서 실패시 오류 반영(두 방식 중 선택)
        - 이전 단계에 대한 보상 트랜잭션
        - 주문 상태 변경

---

**⚠️ 제약 조건**

- `X-USER-ID` 필수(로그인 사용자만 요청 가능)
- 본인 계정의 포인트 내에서 사용 가능
- 재고가 주문 수량만큼 존재해야 함
- 외부 PG 결제 승인 및 재고가 차감되어야 주문 확정 가능
- 결제 승인 실패 처리 정책:
    - **사용자 귀책 사유** (잔고 부족, 카드 한도 초과 등) → **주문 실패 처리**
    - **외부 PG 시스템 오류** (장애, 타임아웃 등) → **주문 상태: `결제대기`로 전환**

---

**❌ 실패 케이스**

| **케이스** | **응답 코드** | 비고 |
| --- | --- | --- |
| 인증 불가 | `401 UNAUTHORIZED` | 1)`X-USER-ID` 헤더 없음<br> 2)`X-USER-ID`는 있으나 유효한 사용자가 아님 |
| 불가능한 상품 | `404 NOT FOUND` | 1)상품이 존재하지 않거나 삭제된 경우<br>2)비공개 상품(사용자) |
| 요청 충돌 | `409 CONFLICT` | 1)재고 부족 또는 처리 중 예외 발생<br> 2)포인트 부족 또는 처리 중 예외 발생<br> 3)`판매중` 상태가 아닌 경우 |
| 상품 수량 초과 | `400 BAD REQUEST` | 최대 수량 제한 등 비즈니스 룰 위반 |
| 주문 정보 저장 실패 | `500 INTERNAL SERVER ERROR` | DB 연결 실패, 트랜잭션 실패 등 |
| 결제 승인 실패 | `HTTP 202 Accepted` | 잔고 부족, 카드 한도 초과, 외부 서비스 장애 등 |

### ⚙️ 비기능적 요구사항

- 성능
    - 내부 처리 (주문 생성, 재고 차감, 포인트 차감): **500ms 이내 응답**
    - 외부 PG 결제 연동 포함 시: **1200ms 이내 응답**
- 동시성 상황
    - 중복 주문 방지
    - 다중 사용자의 요청 충돌 방지